{% comment %}
  Header Section
  Minimal, clean navigation inspired by postfamiliar.com
  Features: Logo, main nav, cart icon, mobile menu, dark mode toggle
{% endcomment %}

{{ 'header.css' | asset_url | stylesheet_tag }}

<header 
  class="header{% if section.settings.sticky %} header--sticky{% endif %}{% if section.settings.transparent_home and template.name == 'index' %} header--transparent{% endif %}"
  data-header
>
  <div class="header__inner container">
    
    {%- comment -%} Mobile Menu Toggle {%- endcomment -%}
    <button 
      class="header__menu-toggle hide-desktop" 
      aria-label="{{ 'accessibility.menu' | t }}"
      aria-expanded="false"
      data-menu-toggle
    >
      <span class="header__menu-icon">
        <span></span>
        <span></span>
      </span>
    </button>

    {%- comment -%} Logo {%- endcomment -%}
    <div class="header__logo">
      <a href="{{ routes.root_url }}" class="header__logo-link">
        {%- if section.settings.logo != blank -%}
          <img 
            src="{{ section.settings.logo | image_url: width: 400 }}"
            alt="{{ shop.name }}"
            class="header__logo-image"
            width="{{ section.settings.logo_width }}"
            height="auto"
            loading="eager"
          >
        {%- else -%}
          <span class="header__logo-text">{{ shop.name }}</span>
        {%- endif -%}
      </a>
    </div>

    {%- comment -%} Desktop Navigation {%- endcomment -%}
    <nav class="header__nav hide-mobile" role="navigation" aria-label="{{ 'accessibility.main_navigation' | t }}">
      <ul class="header__nav-list">
        {%- for link in section.settings.menu.links -%}
          <li class="header__nav-item{% if link.links != blank %} has-dropdown{% endif %}">
            {%- if link.links != blank -%}
              <button 
                class="header__nav-link" 
                aria-expanded="false"
                data-dropdown-toggle
              >
                {{ link.title }}
                <svg class="header__nav-arrow" width="10" height="6" viewBox="0 0 10 6" fill="none">
                  <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              
              {%- comment -%} Dropdown / Mega Menu {%- endcomment -%}
              <div class="header__dropdown" data-dropdown>
                <div class="header__dropdown-inner">
                  {%- for childlink in link.links -%}
                    <a href="{{ childlink.url }}" class="header__dropdown-link">
                      {{ childlink.title }}
                    </a>
                  {%- endfor -%}
                </div>
              </div>
            {%- else -%}
              <a href="{{ link.url }}" class="header__nav-link{% if link.active %} is-active{% endif %}">
                {{ link.title }}
              </a>
            {%- endif -%}
          </li>
        {%- endfor -%}
      </ul>
    </nav>

    {%- comment -%} Header Actions {%- endcomment -%}
    <div class="header__actions">
      
      {%- comment -%} Search Toggle {%- endcomment -%}
      {%- if section.settings.show_search -%}
        <button 
          class="header__action-btn" 
          aria-label="{{ 'accessibility.search' | t }}"
          data-search-toggle
        >
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="1.5"/>
            <path d="M13.5 13.5L17 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      {%- endif -%}

      {%- comment -%} Dark Mode Toggle {%- endcomment -%}
      {%- if section.settings.show_theme_toggle -%}
        <button 
          class="header__action-btn" 
          aria-label="{{ 'accessibility.toggle_theme' | t }}"
          data-theme-toggle
        >
          <svg class="icon-sun" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="1.5"/>
            <path d="M10 2V4M10 16V18M18 10H16M4 10H2M15.66 4.34L14.24 5.76M5.76 14.24L4.34 15.66M15.66 15.66L14.24 14.24M5.76 5.76L4.34 4.34" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <svg class="icon-moon" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M17.5 10.5C17.5 14.366 14.366 17.5 10.5 17.5C6.63401 17.5 3.5 14.366 3.5 10.5C3.5 6.63401 6.63401 3.5 10.5 3.5C7.18629 3.5 4.5 6.18629 4.5 9.5C4.5 12.8137 7.18629 15.5 10.5 15.5C13.8137 15.5 16.5 12.8137 16.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      {%- endif -%}

      {%- comment -%} Account Link {%- endcomment -%}
      {%- if shop.customer_accounts_enabled and section.settings.show_account -%}
        <a 
          href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
          class="header__action-btn hide-mobile"
          aria-label="{{ 'accessibility.account' | t }}"
        >
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="6" r="4" stroke="currentColor" stroke-width="1.5"/>
            <path d="M3 18C3 14.134 6.13401 11 10 11C13.866 11 17 14.134 17 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </a>
      {%- endif -%}

      {%- comment -%} Cart Button {%- endcomment -%}
      <button 
        class="header__action-btn header__cart-btn" 
        aria-label="{{ 'accessibility.cart' | t }} ({{ cart.item_count }})"
        data-cart-toggle
      >
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M4 5H16L15 15H5L4 5Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
          <path d="M7 8V4C7 2.34315 8.34315 1 10 1C11.6569 1 13 2.34315 13 4V8" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        <span class="header__cart-count{% if cart.item_count == 0 %} hidden{% endif %}" data-cart-count>
          {{ cart.item_count }}
        </span>
      </button>
    </div>
  </div>
</header>

{%- comment -%} Mobile Navigation Drawer {%- endcomment -%}
<div class="mobile-nav" data-mobile-nav>
  <div class="mobile-nav__overlay" data-mobile-nav-overlay></div>
  <nav class="mobile-nav__drawer" role="navigation" aria-label="{{ 'accessibility.mobile_navigation' | t }}">
    <div class="mobile-nav__header">
      <span class="mobile-nav__title">{{ 'general.menu' | t }}</span>
      <button class="mobile-nav__close" aria-label="{{ 'accessibility.close' | t }}" data-mobile-nav-close>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M6 6L18 18M6 18L18 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <ul class="mobile-nav__list">
      {%- for link in section.settings.menu.links -%}
        <li class="mobile-nav__item{% if link.links != blank %} has-children{% endif %}">
          {%- if link.links != blank -%}
            <button class="mobile-nav__link" data-mobile-accordion-toggle>
              {{ link.title }}
              <svg class="mobile-nav__arrow" width="12" height="12" viewBox="0 0 12 12" fill="none">
                <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="mobile-nav__submenu accordion-content" data-mobile-accordion>
              <div>
                {%- for childlink in link.links -%}
                  <a href="{{ childlink.url }}" class="mobile-nav__sublink">
                    {{ childlink.title }}
                  </a>
                {%- endfor -%}
              </div>
            </div>
          {%- else -%}
            <a href="{{ link.url }}" class="mobile-nav__link{% if link.active %} is-active{% endif %}">
              {{ link.title }}
            </a>
          {%- endif -%}
        </li>
      {%- endfor -%}
    </ul>

    {%- if shop.customer_accounts_enabled -%}
      <div class="mobile-nav__footer">
        <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" class="mobile-nav__footer-link">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="6" r="4" stroke="currentColor" stroke-width="1.5"/>
            <path d="M3 18C3 14.134 6.13401 11 10 11C13.866 11 17 14.134 17 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          {%- if customer -%}
            {{ 'general.account' | t }}
          {%- else -%}
            {{ 'general.login' | t }}
          {%- endif -%}
        </a>
      </div>
    {%- endif -%}
  </nav>
</div>

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 120,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "checkbox",
      "id": "sticky",
      "default": true,
      "label": "Sticky header"
    },
    {
      "type": "checkbox",
      "id": "transparent_home",
      "default": false,
      "label": "Transparent header on homepage"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "default": true,
      "label": "Show search icon"
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "default": true,
      "label": "Show account icon"
    },
    {
      "type": "checkbox",
      "id": "show_theme_toggle",
      "default": true,
      "label": "Show dark/light mode toggle"
    }
  ]
}
{% endschema %}
