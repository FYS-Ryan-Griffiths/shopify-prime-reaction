{% comment %}
  Bento Grid Section
  Dynamic asymmetric layout for showcasing products/content
{% endcomment %}

{%- style -%}
.bento-grid { padding: var(--spacing-section) 0; }
.bento-grid__inner { max-width: var(--page-width); margin: 0 auto; padding: 0 var(--spacing-6); }
.bento-grid__header { text-align: center; margin-bottom: var(--spacing-10); }
.bento-grid__title { font-family: var(--font-heading-family); font-size: var(--font-size-3xl); margin: 0 0 var(--spacing-4); }
.bento-grid__grid { display: grid; grid-template-columns: repeat(4, 1fr); grid-auto-rows: 200px; gap: var(--spacing-4); }
.bento-item { position: relative; border-radius: var(--radius-lg); overflow: hidden; background: var(--color-background-secondary); }
.bento-item--large { grid-column: span 2; grid-row: span 2; }
.bento-item--wide { grid-column: span 2; }
.bento-item--tall { grid-row: span 2; }
.bento-item__link { display: block; width: 100%; height: 100%; text-decoration: none; color: inherit; }
.bento-item__media { position: absolute; inset: 0; }
.bento-item__media img, .bento-item__media video { width: 100%; height: 100%; object-fit: cover; transition: transform var(--duration-long) ease; }
.bento-item:hover .bento-item__media img { transform: scale(1.05); }
.bento-item__overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent 60%); }
.bento-item__content { position: absolute; bottom: 0; left: 0; right: 0; padding: var(--spacing-6); color: #fff; }
.bento-item__label { font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8; margin-bottom: var(--spacing-2); }
.bento-item__name { font-family: var(--font-heading-family); font-size: var(--font-size-xl); font-weight: 600; margin: 0 0 var(--spacing-2); }
.bento-item--large .bento-item__name { font-size: var(--font-size-2xl); }
.bento-item__price { font-size: var(--font-size-base); opacity: 0.9; }
.bento-item__badge { position: absolute; top: var(--spacing-4); left: var(--spacing-4); padding: var(--spacing-1) var(--spacing-3); font-size: var(--font-size-xs); font-weight: 600; text-transform: uppercase; background: var(--color-accent); color: #fff; border-radius: var(--radius-full); }
@media (max-width: 989px) { .bento-grid__grid { grid-template-columns: repeat(2, 1fr); grid-auto-rows: 180px; } .bento-item--large { grid-column: span 2; } .bento-item--wide { grid-column: span 2; } .bento-item--tall { grid-row: span 2; } }
@media (max-width: 749px) { .bento-grid__grid { grid-template-columns: 1fr; grid-auto-rows: 250px; } .bento-item--large, .bento-item--wide { grid-column: span 1; } }
{%- endstyle -%}

<section class="bento-grid color-{{ section.settings.color_scheme }}">
  <div class="bento-grid__inner">
    {% if section.settings.heading != blank %}
    <header class="bento-grid__header">
      <h2 class="bento-grid__title">{{ section.settings.heading }}</h2>
      {% if section.settings.subheading != blank %}
      <p class="bento-grid__subtitle">{{ section.settings.subheading }}</p>
      {% endif %}
    </header>
    {% endif %}

    <div class="bento-grid__grid">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'product' %}
            {% assign product = block.settings.product %}
            <article class="bento-item bento-item--{{ block.settings.size }}" {{ block.shopify_attributes }}>
              <a href="{{ product.url | default: '#' }}" class="bento-item__link">
                <div class="bento-item__media">
                  {% if product.featured_media %}
                    {{ product.featured_media | image_url: width: 800 | image_tag: loading: 'lazy', alt: product.title }}
                  {% else %}
                    {{ 'product-1' | placeholder_svg_tag }}
                  {% endif %}
                </div>
                <div class="bento-item__overlay"></div>
                <div class="bento-item__content">
                  <span class="bento-item__label">{{ product.type | default: 'Product' }}</span>
                  <h3 class="bento-item__name">{{ product.title | default: 'Product Name' }}</h3>
                  <span class="bento-item__price">{{ product.price | money }}</span>
                </div>
                {% if product.available == false %}
                <span class="bento-item__badge">Sold Out</span>
                {% endif %}
              </a>
            </article>

          {% when 'collection' %}
            {% assign collection = block.settings.collection %}
            <article class="bento-item bento-item--{{ block.settings.size }}" {{ block.shopify_attributes }}>
              <a href="{{ collection.url | default: '#' }}" class="bento-item__link">
                <div class="bento-item__media">
                  {% if collection.image %}
                    {{ collection.image | image_url: width: 800 | image_tag: loading: 'lazy', alt: collection.title }}
                  {% elsif collection.products.first.featured_media %}
                    {{ collection.products.first.featured_media | image_url: width: 800 | image_tag: loading: 'lazy' }}
                  {% else %}
                    {{ 'collection-1' | placeholder_svg_tag }}
                  {% endif %}
                </div>
                <div class="bento-item__overlay"></div>
                <div class="bento-item__content">
                  <span class="bento-item__label">Collection</span>
                  <h3 class="bento-item__name">{{ collection.title | default: 'Collection' }}</h3>
                  <span class="bento-item__price">{{ collection.products_count }} products</span>
                </div>
              </a>
            </article>

          {% when 'custom' %}
            <article class="bento-item bento-item--{{ block.settings.size }}" {{ block.shopify_attributes }}>
              <a href="{{ block.settings.link | default: '#' }}" class="bento-item__link">
                <div class="bento-item__media">
                  {% if block.settings.image %}
                    {{ block.settings.image | image_url: width: 800 | image_tag: loading: 'lazy', alt: block.settings.heading }}
                  {% else %}
                    {{ 'lifestyle-1' | placeholder_svg_tag }}
                  {% endif %}
                </div>
                <div class="bento-item__overlay"></div>
                <div class="bento-item__content">
                  {% if block.settings.label != blank %}
                  <span class="bento-item__label">{{ block.settings.label }}</span>
                  {% endif %}
                  <h3 class="bento-item__name">{{ block.settings.heading | default: 'Heading' }}</h3>
                  {% if block.settings.text != blank %}
                  <span class="bento-item__price">{{ block.settings.text }}</span>
                  {% endif %}
                </div>
              </a>
            </article>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Bento Grid",
  "tag": "section",
  "class": "section-bento-grid",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Shop the Collection" },
    { "type": "text", "id": "subheading", "label": "Subheading" },
    { "type": "select", "id": "color_scheme", "label": "Color scheme", "default": "background-1", "options": [
      { "value": "background-1", "label": "Background 1" },
      { "value": "background-2", "label": "Background 2" },
      { "value": "inverse", "label": "Inverse" }
    ]}
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        { "type": "product", "id": "product", "label": "Product" },
        { "type": "select", "id": "size", "label": "Size", "default": "default", "options": [
          { "value": "default", "label": "Default" },
          { "value": "large", "label": "Large" },
          { "value": "wide", "label": "Wide" },
          { "value": "tall", "label": "Tall" }
        ]}
      ]
    },
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        { "type": "collection", "id": "collection", "label": "Collection" },
        { "type": "select", "id": "size", "label": "Size", "default": "default", "options": [
          { "value": "default", "label": "Default" },
          { "value": "large", "label": "Large" },
          { "value": "wide", "label": "Wide" },
          { "value": "tall", "label": "Tall" }
        ]}
      ]
    },
    {
      "type": "custom",
      "name": "Custom",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "label", "label": "Label" },
        { "type": "text", "id": "heading", "label": "Heading", "default": "Custom Block" },
        { "type": "text", "id": "text", "label": "Text" },
        { "type": "url", "id": "link", "label": "Link" },
        { "type": "select", "id": "size", "label": "Size", "default": "default", "options": [
          { "value": "default", "label": "Default" },
          { "value": "large", "label": "Large" },
          { "value": "wide", "label": "Wide" },
          { "value": "tall", "label": "Tall" }
        ]}
      ]
    }
  ],
  "presets": [{ "name": "Bento Grid", "blocks": [
    { "type": "product", "settings": { "size": "large" }},
    { "type": "product" },
    { "type": "product" },
    { "type": "collection", "settings": { "size": "wide" }},
    { "type": "custom", "settings": { "size": "tall" }},
    { "type": "product" }
  ]}]
}
{% endschema %}
