{% comment %}
  Predictive Search Section
  Search modal with instant results and keyboard navigation
{% endcomment %}

{{ 'search.css' | asset_url | stylesheet_tag }}

<div class="search-modal" data-search-modal aria-hidden="true" role="dialog" aria-label="{{ 'search.title' | t }}">
  <div class="search-modal__overlay" data-search-close></div>
  <div class="search-modal__container">
    <div class="search-modal__content">
      <form action="{{ routes.search_url }}" method="get" class="search-modal__form" role="search">
        <label for="predictive-search-input" class="visually-hidden">{{ 'search.placeholder' | t }}</label>
        <input 
          type="search" 
          id="predictive-search-input"
          name="q" 
          placeholder="{{ 'search.placeholder' | t }}"
          class="search-modal__input"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          data-search-input
          aria-autocomplete="list"
          aria-controls="predictive-search-results"
        >
        <input type="hidden" name="type" value="{{ section.settings.search_type }}">
        <button type="submit" class="search-modal__submit" aria-label="{{ 'accessibility.search' | t }}">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="1.5"/>
            <path d="M13.5 13.5L17 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </form>
      <button class="search-modal__close" aria-label="{{ 'accessibility.close' | t }}" data-search-close>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6L18 18M6 18L18 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <div id="predictive-search-results" class="search-modal__results" data-search-results role="listbox" aria-label="{{ 'search.results' | t }}">
      {%- comment -%} Results populated by search.js {%- endcomment -%}
    </div>

    {%- if section.settings.show_keyboard_hint -%}
      <div class="search-modal__hint">
        <span>{{ 'search.keyboard_hint' | t | default: 'Press' }}</span>
        <kbd>ESC</kbd>
        <span>{{ 'search.to_close' | t | default: 'to close' }}</span>
      </div>
    {%- endif -%}
  </div>
</div>

<script src="{{ 'search.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Predictive Search",
  "class": "section-predictive-search",
  "settings": [
    {
      "type": "select",
      "id": "search_type",
      "label": "Search type",
      "options": [
        { "value": "product", "label": "Products only" },
        { "value": "product,article,page", "label": "Products, articles & pages" },
        { "value": "product,page", "label": "Products & pages" }
      ],
      "default": "product,article,page"
    },
    {
      "type": "checkbox",
      "id": "show_keyboard_hint",
      "label": "Show keyboard shortcut hint",
      "default": true
    }
  ]
}
{% endschema %}
