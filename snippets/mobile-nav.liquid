{% comment %}
  Mobile Navigation Snippet
  Renders a thumb-friendly fixed bottom navigation bar for mobile
  
  Usage:
  {% render 'mobile-nav' %}
{% endcomment %}

<nav class="mobile-nav" aria-label="{{ 'accessibility.mobile_navigation' | t }}">
  <ul class="mobile-nav__list">
    {% comment %} Home {% endcomment %}
    <li class="mobile-nav__item">
      <a 
        href="{{ routes.root_url }}" 
        class="mobile-nav__link{% if template.name == 'index' %} is-active{% endif %}"
        aria-label="{{ 'general.navigation.home' | t | default: 'Home' }}"
        {% if template.name == 'index' %}aria-current="page"{% endif %}
      >
        <svg class="mobile-nav__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="mobile-nav__label">{{ 'general.navigation.home' | t | default: 'Home' }}</span>
      </a>
    </li>
    
    {% comment %} Shop/Collections {% endcomment %}
    <li class="mobile-nav__item">
      <a 
        href="{{ routes.collections_url }}" 
        class="mobile-nav__link{% if template.name == 'collection' or template.name == 'list-collections' %} is-active{% endif %}"
        aria-label="{{ 'general.navigation.shop' | t | default: 'Shop' }}"
        {% if template.name == 'collection' %}aria-current="page"{% endif %}
      >
        <svg class="mobile-nav__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 4H8L10 10H20L18 16H10M10 16L8 10M10 16H6M18 20C18 20.5523 17.5523 21 17 21C16.4477 21 16 20.5523 16 20C16 19.4477 16.4477 19 17 19C17.5523 19 18 19.4477 18 20ZM9 20C9 20.5523 8.55228 21 8 21C7.44772 21 7 20.5523 7 20C7 19.4477 7.44772 19 8 19C8.55228 19 9 19.4477 9 20Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="mobile-nav__label">{{ 'general.navigation.shop' | t | default: 'Shop' }}</span>
      </a>
    </li>
    
    {% comment %} Search {% endcomment %}
    <li class="mobile-nav__item">
      <button 
        class="mobile-nav__link mobile-nav__search-toggle"
        aria-label="{{ 'general.search.search' | t | default: 'Search' }}"
        data-search-toggle
      >
        <svg class="mobile-nav__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="mobile-nav__label">{{ 'general.search.search' | t | default: 'Search' }}</span>
      </button>
    </li>
    
    {% comment %} Account {% endcomment %}
    <li class="mobile-nav__item">
      {% if customer %}
        <a 
          href="{{ routes.account_url }}" 
          class="mobile-nav__link{% if request.path contains 'account' %} is-active{% endif %}"
          aria-label="{{ 'customer.account.title' | t | default: 'Account' }}"
        >
          <svg class="mobile-nav__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="mobile-nav__label">{{ 'customer.account.title' | t | default: 'Account' }}</span>
        </a>
      {% else %}
        <a 
          href="{{ routes.account_login_url }}" 
          class="mobile-nav__link"
          aria-label="{{ 'customer.login.sign_in' | t | default: 'Sign In' }}"
        >
          <svg class="mobile-nav__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="mobile-nav__label">{{ 'customer.login.sign_in' | t | default: 'Sign In' }}</span>
        </a>
      {% endif %}
    </li>
    
    {% comment %} Cart {% endcomment %}
    <li class="mobile-nav__item">
      <a 
        href="{{ routes.cart_url }}" 
        class="mobile-nav__link mobile-nav__cart{% if template.name == 'cart' %} is-active{% endif %}"
        aria-label="{{ 'sections.cart.title' | t | default: 'Cart' }}"
        data-cart-toggle
      >
        <div class="mobile-nav__cart-wrapper">
          <svg class="mobile-nav__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M16 11V7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7V11M5 9H19L20 21H4L5 9Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span 
            class="mobile-nav__cart-count{% if cart.item_count == 0 %} is-hidden{% endif %}"
            data-cart-count
          >
            {{ cart.item_count }}
          </span>
        </div>
        <span class="mobile-nav__label">{{ 'sections.cart.title' | t | default: 'Cart' }}</span>
      </a>
    </li>
  </ul>
  
  {% comment %} Mobile Menu Overlay (Full Screen) {% endcomment %}
  <div class="mobile-nav__overlay" data-mobile-menu-overlay hidden>
    <div class="mobile-nav__overlay-inner">
      <button class="mobile-nav__close" data-mobile-menu-close aria-label="{{ 'accessibility.close' | t }}">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <nav class="mobile-nav__menu" aria-label="{{ 'accessibility.main_navigation' | t }}">
        <ul class="mobile-nav__menu-list">
          {% for link in linklists[section.settings.menu].links %}
            <li class="mobile-nav__menu-item{% if link.links.size > 0 %} has-children{% endif %}">
              {% if link.links.size > 0 %}
                <button 
                  class="mobile-nav__menu-link mobile-nav__menu-toggle"
                  aria-expanded="false"
                  data-mobile-submenu-toggle
                >
                  {{ link.title }}
                  <svg class="mobile-nav__menu-arrow" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <ul class="mobile-nav__submenu" data-mobile-submenu hidden>
                  <li class="mobile-nav__submenu-header">
                    <button class="mobile-nav__back" data-mobile-submenu-back>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                        <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      {{ 'general.navigation.back' | t | default: 'Back' }}
                    </button>
                  </li>
                  <li>
                    <a href="{{ link.url }}" class="mobile-nav__submenu-title">
                      {{ 'general.navigation.view_all' | t | default: 'View All' }} {{ link.title }}
                    </a>
                  </li>
                  {% for child_link in link.links %}
                    <li>
                      <a 
                        href="{{ child_link.url }}" 
                        class="mobile-nav__submenu-link"
                        {% if child_link.current %}aria-current="page"{% endif %}
                      >
                        {{ child_link.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <a 
                  href="{{ link.url }}" 
                  class="mobile-nav__menu-link"
                  {% if link.current %}aria-current="page"{% endif %}
                >
                  {{ link.title }}
                </a>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>
      
      {% comment %} Secondary Links {% endcomment %}
      <div class="mobile-nav__secondary">
        {% if customer %}
          <a href="{{ routes.account_url }}" class="mobile-nav__secondary-link">
            {{ 'customer.account.title' | t | default: 'My Account' }}
          </a>
          <a href="{{ routes.account_logout_url }}" class="mobile-nav__secondary-link">
            {{ 'customer.log_out' | t | default: 'Log Out' }}
          </a>
        {% else %}
          <a href="{{ routes.account_login_url }}" class="mobile-nav__secondary-link">
            {{ 'customer.login.sign_in' | t | default: 'Sign In' }}
          </a>
          <a href="{{ routes.account_register_url }}" class="mobile-nav__secondary-link">
            {{ 'customer.register.title' | t | default: 'Create Account' }}
          </a>
        {% endif %}
      </div>
      
      {% comment %} Theme Toggle in Mobile Menu {% endcomment %}
      {% if settings.enable_dark_mode %}
        <div class="mobile-nav__theme-toggle">
          <button class="theme-toggle" data-theme-toggle aria-label="{{ 'accessibility.toggle_theme' | t }}">
            <svg class="theme-toggle__icon theme-toggle__icon--light" width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
              <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="1.5"/>
              <path d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <svg class="theme-toggle__icon theme-toggle__icon--dark" width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
              <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{{ 'accessibility.toggle_theme' | t | default: 'Toggle Theme' }}</span>
          </button>
        </div>
      {% endif %}
    </div>
  </div>
</nav>

<style>
  .mobile-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: var(--z-fixed, 1000);
    background: var(--color-background);
    border-top: 1px solid var(--color-border);
    padding-bottom: env(safe-area-inset-bottom, 0);
  }
  
  .mobile-nav__list {
    display: flex;
    justify-content: space-around;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
    height: 60px;
  }
  
  .mobile-nav__item {
    flex: 1;
    display: flex;
    justify-content: center;
  }
  
  .mobile-nav__link {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-1, 0.25rem);
    padding: var(--spacing-2, 0.5rem);
    color: var(--color-foreground-muted);
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    transition: color var(--duration-short) ease;
    -webkit-tap-highlight-color: transparent;
  }
  
  .mobile-nav__link:hover,
  .mobile-nav__link:focus-visible,
  .mobile-nav__link.is-active {
    color: var(--color-accent);
  }
  
  .mobile-nav__icon {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
  }
  
  .mobile-nav__label {
    font-size: 10px;
    font-weight: var(--font-weight-medium, 500);
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }
  
  .mobile-nav__cart-wrapper {
    position: relative;
  }
  
  .mobile-nav__cart-count {
    position: absolute;
    top: -6px;
    right: -6px;
    min-width: 18px;
    height: 18px;
    padding: 0 4px;
    font-size: 10px;
    font-weight: var(--font-weight-semibold, 600);
    line-height: 18px;
    text-align: center;
    color: var(--color-background);
    background: var(--color-accent);
    border-radius: 9px;
  }
  
  .mobile-nav__cart-count.is-hidden {
    display: none;
  }
  
  /* Full Screen Overlay */
  .mobile-nav__overlay {
    position: fixed;
    inset: 0;
    z-index: var(--z-modal, 1001);
    background: var(--color-background);
    overflow-y: auto;
    transform: translateX(-100%);
    transition: transform var(--duration-medium) ease;
  }
  
  .mobile-nav__overlay[hidden] {
    display: block;
    visibility: hidden;
  }
  
  .mobile-nav__overlay.is-open {
    transform: translateX(0);
    visibility: visible;
  }
  
  .mobile-nav__overlay-inner {
    min-height: 100%;
    padding: var(--spacing-6, 1.5rem);
    padding-top: calc(var(--spacing-6, 1.5rem) + env(safe-area-inset-top, 0));
    padding-bottom: calc(80px + env(safe-area-inset-bottom, 0));
    display: flex;
    flex-direction: column;
  }
  
  .mobile-nav__close {
    position: absolute;
    top: var(--spacing-4, 1rem);
    right: var(--spacing-4, 1rem);
    padding: var(--spacing-2, 0.5rem);
    background: none;
    border: none;
    color: var(--color-foreground);
    cursor: pointer;
  }
  
  .mobile-nav__menu {
    flex: 1;
    margin-top: var(--spacing-8, 2rem);
  }
  
  .mobile-nav__menu-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .mobile-nav__menu-item {
    border-bottom: 1px solid var(--color-border);
  }
  
  .mobile-nav__menu-link {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: var(--spacing-4, 1rem) 0;
    font-family: var(--font-heading-family);
    font-size: var(--font-size-xl, 1.25rem);
    font-weight: var(--font-weight-medium, 500);
    color: var(--color-foreground);
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
  }
  
  .mobile-nav__menu-link[aria-current="page"] {
    color: var(--color-accent);
  }
  
  .mobile-nav__menu-arrow {
    transition: transform var(--duration-short) ease;
  }
  
  .mobile-nav__menu-toggle[aria-expanded="true"] .mobile-nav__menu-arrow {
    transform: rotate(90deg);
  }
  
  /* Submenu */
  .mobile-nav__submenu {
    position: fixed;
    inset: 0;
    z-index: 1;
    background: var(--color-background);
    list-style: none;
    margin: 0;
    padding: var(--spacing-6, 1.5rem);
    padding-top: calc(var(--spacing-6, 1.5rem) + env(safe-area-inset-top, 0));
    transform: translateX(100%);
    transition: transform var(--duration-medium) ease;
    overflow-y: auto;
  }
  
  .mobile-nav__submenu[hidden] {
    display: block;
    visibility: hidden;
  }
  
  .mobile-nav__submenu.is-open {
    transform: translateX(0);
    visibility: visible;
  }
  
  .mobile-nav__submenu-header {
    margin-bottom: var(--spacing-6, 1.5rem);
  }
  
  .mobile-nav__back {
    display: flex;
    align-items: center;
    gap: var(--spacing-2, 0.5rem);
    padding: 0;
    font-size: var(--font-size-sm, 0.875rem);
    color: var(--color-foreground-muted);
    background: none;
    border: none;
    cursor: pointer;
  }
  
  .mobile-nav__submenu-title {
    display: block;
    padding: var(--spacing-3, 0.75rem) 0;
    font-family: var(--font-heading-family);
    font-size: var(--font-size-lg, 1.125rem);
    font-weight: var(--font-weight-semibold, 600);
    color: var(--color-accent);
    text-decoration: none;
    border-bottom: 1px solid var(--color-border);
  }
  
  .mobile-nav__submenu-link {
    display: block;
    padding: var(--spacing-3, 0.75rem) 0;
    font-size: var(--font-size-base, 1rem);
    color: var(--color-foreground);
    text-decoration: none;
    border-bottom: 1px solid var(--color-border-light);
  }
  
  .mobile-nav__submenu-link[aria-current="page"] {
    color: var(--color-accent);
  }
  
  /* Secondary Links */
  .mobile-nav__secondary {
    margin-top: var(--spacing-8, 2rem);
    padding-top: var(--spacing-4, 1rem);
    border-top: 1px solid var(--color-border);
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-4, 1rem);
  }
  
  .mobile-nav__secondary-link {
    font-size: var(--font-size-sm, 0.875rem);
    color: var(--color-foreground-muted);
    text-decoration: none;
  }
  
  .mobile-nav__secondary-link:hover {
    color: var(--color-accent);
  }
  
  /* Theme Toggle */
  .mobile-nav__theme-toggle {
    margin-top: var(--spacing-6, 1.5rem);
  }
  
  .mobile-nav__theme-toggle .theme-toggle {
    display: flex;
    align-items: center;
    gap: var(--spacing-3, 0.75rem);
    padding: var(--spacing-3, 0.75rem);
    width: 100%;
    font-size: var(--font-size-sm, 0.875rem);
    color: var(--color-foreground);
    background: var(--color-background-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md, 0.5rem);
    cursor: pointer;
  }
  
  /* Hide on desktop */
  @media screen and (min-width: 990px) {
    .mobile-nav {
      display: none;
    }
  }
  
  /* Adjust page padding for mobile nav */
  @media screen and (max-width: 989px) {
    body {
      padding-bottom: calc(60px + env(safe-area-inset-bottom, 0));
    }
  }
</style>

<script>
  (function() {
    const mobileNav = document.querySelector('.mobile-nav');
    if (!mobileNav) return;
    
    const overlay = mobileNav.querySelector('[data-mobile-menu-overlay]');
    const closeBtn = mobileNav.querySelector('[data-mobile-menu-close]');
    const submenuToggles = mobileNav.querySelectorAll('[data-mobile-submenu-toggle]');
    const backBtns = mobileNav.querySelectorAll('[data-mobile-submenu-back]');
    
    // Open main menu (triggered from hamburger in header)
    document.addEventListener('mobile-menu:open', () => {
      overlay.classList.add('is-open');
      overlay.removeAttribute('hidden');
      document.body.style.overflow = 'hidden';
    });
    
    // Close main menu
    function closeMenu() {
      overlay.classList.remove('is-open');
      document.body.style.overflow = '';
      
      // Close all submenus
      mobileNav.querySelectorAll('[data-mobile-submenu]').forEach(submenu => {
        submenu.classList.remove('is-open');
      });
      submenuToggles.forEach(toggle => {
        toggle.setAttribute('aria-expanded', 'false');
      });
    }
    
    closeBtn?.addEventListener('click', closeMenu);
    
    // Submenu toggles
    submenuToggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const submenu = toggle.nextElementSibling;
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        
        toggle.setAttribute('aria-expanded', !isExpanded);
        submenu.classList.toggle('is-open', !isExpanded);
      });
    });
    
    // Back buttons
    backBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const submenu = btn.closest('[data-mobile-submenu]');
        const toggle = submenu.previousElementSibling;
        
        submenu.classList.remove('is-open');
        toggle.setAttribute('aria-expanded', 'false');
      });
    });
    
    // Search toggle
    const searchToggle = mobileNav.querySelector('[data-search-toggle]');
    searchToggle?.addEventListener('click', () => {
      document.dispatchEvent(new CustomEvent('search:open'));
    });
    
    // Cart toggle
    const cartToggle = mobileNav.querySelector('[data-cart-toggle]');
    cartToggle?.addEventListener('click', (e) => {
      e.preventDefault();
      document.dispatchEvent(new CustomEvent('cart:open'));
    });
    
    // Update cart count
    document.addEventListener('cart:updated', (e) => {
      const countEl = mobileNav.querySelector('[data-cart-count]');
      if (countEl && e.detail?.itemCount !== undefined) {
        countEl.textContent = e.detail.itemCount;
        countEl.classList.toggle('is-hidden', e.detail.itemCount === 0);
      }
    });
    
    // Close on escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && overlay.classList.contains('is-open')) {
        closeMenu();
      }
    });
  })();
</script>
